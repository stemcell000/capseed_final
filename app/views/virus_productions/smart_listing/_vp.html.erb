  <td class="col-lg-1 col-md-1 col-sm-2 center <%= object.virus_batches.where('volume > ?', 0).any? ? "" :"alert alert-warning" %>"><%= object.nb %></td>
  <td class="col-lg-2 col-md-2 col-sm-2 center <%= object.virus_batches.where('volume > ?', 0).any? ? "" :"alert alert-warning" %>"> <%= object.date_of_production.nil? ? "No data" : object.date_of_production.strftime("%b %e, %Y") %></td>
  <td class="col-lg-2 col-md-2 col-sm-2 center <%= object.virus_batches.where('volume > ?', 0).any? ? "" :"alert alert-warning" %>"> <%= object.production.nil? ? "-" : object.production.name %></td>
  <td class="col-lg-2 col-md-2 col-sm-2 center <%= object.virus_batches.where('volume > ?', 0).any? ? "" :"alert alert-warning" %>"> <%= object.dosages.where(:accepted => true).last.nil? ? "-" : "%.2e"%object.dosages.where(:accepted => true).last.titer_to_atcc+"vg/ml" %></td>
  <td class="col-lg-6 col-md-6 col-sm-4 text-left <%= object.virus_batches.where('volume > ?', 0).any? ? "" :"alert alert-warning" %>">
  	<% unless object.production.nil?%>
  	<% object.production.clone_batches.joins(:type).order('order_set').each do |cb| %>
												  				<span class="text-primary"><strong><%=cb.nb %></strong></span> <span> <%=cb.name %> </span><br />
												  	<%end%>
	<%else%>
			<span>Unknown set of plasmids</span>
	<%end%>
  <td class="col-lg-6 col-md-6 col-sm-6 actions text-right <%= object.virus_batches.where('volume > ?', 0).any? ? "" :"alert alert-warning" %>">
  	
	  <a tabindex="0" data-toggle="popover" data-trigger="focus" data-placement="left"
			title='
				<div class="row"> 
					<div class="col-lg-12 text-left primary <%if object.id%>">
						<strong>ID: <%=object.nb%></strong><br />
						<strong>Created on: <%=object.created_at.strftime("%b %e, %Y")%></strong>
					</div>
				</div>'
				data-content='	
				<small>
								
								<strong>Associated plasmids: </strong>
								<% if object.clone_batches.empty? %>
										No plasmid<br />
									<%else%>
									<table>
										<% object.clone_batches.each do |cb| %> 
										<tr>
											<td><%=cb.number%></td>
											<td><%= cb.name%></td>
										<tr>
										<%end%>
									</table>
								<%end%>
								<strong>Date of prod.: </strong> <%= object.date_of_production.nil? ? "none" : object.date_of_production.strftime("%b %e, %Y") %><br />
								<strong>Volume: </strong> <%= object.vol.nil? ? "none" : "#{object.vol} #{object.vol_unit.name}" %><br />
								<%unless object.sterilitytests.nil? %>
								<% last_st = object.sterilitytests.last %>
								<%if last_st%>
								<%=last_st.date.nil? ? "none" : last_st.date.strftime("%b %e, %Y") %><br />
									<strong>Last result for sterility: </strong><%= last_st.sterility.nil? ? ">on-going" : int_to_string(last_st.sterility) %><br />
								<%end%>
								<%end%>
								<strong>Gel (Prot.): </strong> <%= object.gel_prot.nil? ? "none" : object.gel_prot %><br />
								<strong>User: </strong><%= object.user.nil? ? "none" : object.user.full_name %><br />
								<% unless object.hek_result.blank? %>
									<strong>HEK results: </strong><%= object.hek_result %><br />
								<%end%>
								<% unless object.comment.blank? %>
									<strong>Comment: </strong><%= object.comment %><br />
								<%end%>
								<% last_dosage = object.dosages.last %>
								<% if last_dosage %>
									<strong> <%= pluralize_without_count(object.dosages.count, 'Inactivation' , ' :')%> </strong><%= object.dosages.map {|dosage| dosage.inactivation.nil? ? "Unknown" : dosage.inactivation.strftime("%b %e, %Y")}.to_sentence %><br />
									
										<strong> Date of the last titration: </strong><%= last_dosage.date.nil? ? "none" : last_dosage.date.strftime("%b %e, %Y") %><br />
										<ul>	
											<li><strong> Titer: </strong> <%= last_dosage.titer.nil? ? "none" : "%.2e" %last_dosage.titer+"vg/ml" %></li>
											<li><strong> Titer ATCC: </strong> <%= last_dosage.titer_atcc.nil? ? "none" : "%.2e" %last_dosage.titer_atcc+"vg/ml" %></li>
											<li><strong> Titer to ATCC: </strong> <%= last_dosage.titer_to_atcc.nil? ? "none" : "%.2e" %last_dosage.titer_to_atcc+"vg/ml" %></li>
										</ul>
								<%else%>
									<strong>Titer :</strong>None<br />
								<%end%>

			<div>								
			<h6><strong> Virus batches: </strong></h6>
			<% unless object.virus_batches.empty? %>
			<small>
				<table class="table table-bordered">
					<thead>
						<th>Batch</th>
						<th>Barcode</th>
						<th>Box</th>
						<th>row/col.</th>
						<th>Volume</th>
						<th>Date of production</th>
						<th>Date of thawing</th>
						<th>Trash</th>
					</thead>
					<%object.virus_batches.each do |vb|%>
					<tr>
						<td><%= vb.name.nil? ? "Unknown" :vb.name %></td>
						<td><%= vb.barcode.nil? ? "Unknown" :vb.number %></td>
						<td><%= vb.box.nil? ? "Unknown" : vb.box.name %></td>
						<td><%= vb.row.nil? ? "Unknown" : vb.row.name %><%= vb.column_id.nil? ? "" : pb.column.name %></td>
						<td class="col-lg-2"><%= vb.volume.nil? ? "Unknown" : "#{vb.volume} #{vb.vol_unit.name}" %></td>
						<td><%= vb.virus_production.date_of_production.nil? ? "Unknown" : vb.virus_production.date_of_production.strftime("%B %e, %Y") %></td>
						<td><%= vb.date_of_thawing.nil? ? "Unknown" : vb.date_of_thawing.strftime("%B %e, %Y") %></td>
						<td><%= vb.trash = true ? "yes" : "no" %></td>
					</tr>
					<%end%>
				</table>
			<%else%>
			No batch
			<%end%>
			</div>
		</div>
		</small>	
			'
		>
			<span class="fa_icon fa fa-eye"></span>
	</a>
	<% if can? :update_virus_production, @virus_production %>
	  <%= smart_listing_item_actions [
	  	{name: :edit,    url: edit_from_inventory_virus_production_path(object),
	  		title: "Edit"},
	  	{name: :custom,    url: add_vb_from_inventory_virus_production_path(object),
	  		method: :get, 
  			icon: "glyphicon glyphicon-th",
  			title: "Add batches"}
	  		]%>
  			
  		<%if object.production_id?%>
  		
  		<%= smart_listing_item_actions [
  			{name: :custom,    url: edit_production_path(object.production_id),
	  		method: :get, 
  			icon: "fa fa-industry", 
  			title: "View production"}
  			]%>
  			  		
  		<%end%>
  	<%end%>
  	<% if can? :destroy_virus_production, @virus_production %>
  			 <%= smart_listing_item_actions [
			{name: :destroy,
			url: virus_production_path(object.id),
			title: "Destroy",
			confirmation: "Are you sure you want to delete this?"}
  			]%>
  	<%end%>
  		<%end%>
</td>