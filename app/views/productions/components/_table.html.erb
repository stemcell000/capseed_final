<% unless @production.plasmid_batches.empty? %>
<table class="table table-bordered " id="plasmid-table">
			<thead>
				<th>Name</th>
				<th>Plasmid</th>
				<th>Type</th>
				<th>Remaining volume</th>
				<th>Prod. volume</th>
			</thead>
		<% @production.plasmid_batch_productions.order(:id).each do |pbp| %>
				<tr>
					<%if pbp.starting_volume.nil? %>
						<%remaining_volume = pbp.plasmid_batch.volume %>
					<%else%>
						<% remaining_volume =  pbp.starting_volume - pbp.volume %>
					<%end%>
						<td class="col-lg-1 col-md-1 col-sm-1 center" > <strong><%=pbp.plasmid_batch.name%></strong></td>
						<td class="col-lg-3 col-md-3 col-sm-4 center"></strong><%= pbp.plasmid_batch.clone_batch.nb %></strong> <%= pbp.plasmid_batch.clone_batch.name %></td>
						<td class="col-lg-1 col-md-1 col-sm-2center"><%= pbp.plasmid_batch.clone_batch.type.name %></td>
						<td class="col-lg-2 col-md-2 col-sm-4"><%= remaining_volume %> <%= pbp.plasmid_batch.vol_unit.name %></td>
						<td class="col-lg-2 col-md-2 col-sm-4"><%= pbp.volume %> <%= pbp.plasmid_batch.vol_unit.name %></td>
			<%end%>
					</tr>
</table>

<div class="row pull-right">
	<div class="col-lg-12 col-sm-12 col-md-12">
		
		
		<% busy_prods= Production.where('last_step < 2').where(:pbtag => @production.pbtag) %>
		
		<% disable_switch = busy_prods.count > 1 %>

	<% if disable_switch == true %>
	
		<% if @production == busy_prods.first %>
		
			<div class="btn-group" role="group" aria-label="...">
				<%= link_to "Set production volumes", set_pb_volume_production_path(@production), :class =>"btn btn-primary btn-sm", :remote => true %>
				<%= link_to "Reset volumes", reset_volume_production_path(@production), :class =>"btn btn-default btn-sm", :remote => true %>
			</div>
			
		<%else%>
		<div class="btn-group" role="group" aria-label="...">
			<%= link_to "Set production volumes", set_pb_volume_production_path(@production), :class =>"btn btn-primary btn-sm", :disabled => disable_switch %>
			<%= link_to "Reset volumes", reset_volume_production_path(@production), :class =>"btn btn-default btn-sm", :disabled => disable_switch %>
		</div>
		<div class="row">
			<div class="col-lg-12 col-md-12 col-sm-12 dismissed">
			This production is blocked. Please, release the previous <%="one".pluralize(busy_prods.where.not(id: @production.id))%> (#<%= busy_prods.where.not(id: @production.id).pluck(:id).to_sentence%>)
			</div>
		</div>
		<%end%>
	<%else%>
		<div class="btn-group" role="group" aria-label="...">
				<%= link_to "Set production volumes", set_pb_volume_production_path(@production), :class =>"btn btn-primary btn-md", :remote => true %>
				<%= link_to "Reset volumes", reset_volume_production_path(@production), :class =>"btn btn-default btn-md", :remote => true %>
		</div>
	<%end%>
	
</div>
</div>

<%else%>
			<div class="row"><div class="col-lg-12"> <i class = "glyphicon glyphicon-arrow-right"></i> No plasmid batch</div></div>
<% end %>

